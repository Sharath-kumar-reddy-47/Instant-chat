<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm Users</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Confirm Users</h1>
    <div id="users"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

        const firebaseConfig = {
                apiKey: "AIzaSyDaya3CCviWxqqfzy1TvfbI_rZbSxws",
                authDomain: "instant-chat-4af7a.firebaseapp.com",
                databaseURL: "https://instant-chat-4af7a-default-rtdb.firebaseio.com/",
                projectId: "instant-chat-4af7a",
                storageBucket: "instant-chat-4af7a.appspot.com",
                messagingSenderId: "387329013608",
                appId: "1:387329013608:web:c3fa1de0b5c72b719488dd",
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const usersDiv = document.getElementById('users');

        const usersRef = ref(database, 'users');
        onValue(usersRef, (snapshot) => {
            usersDiv.innerHTML = ''; // Clear previous list
            snapshot.forEach((childSnapshot) => {
                const user = childSnapshot.val();
                const phoneNumber = childSnapshot.key;

                if (user.status === 'pending') {
                    const userElement = document.createElement('div');
                    userElement.innerHTML = `
                        <p>${user.name}, ${user.age}, ${user.college_name}, ${user.department}</p>
                        <button data-phone="${phoneNumber}" class="approveBtn">Approve</button>
                        <button data-phone="${phoneNumber}" class="rejectBtn">Reject</button>
                    `;
                    usersDiv.appendChild(userElement);
                }
            });

            document.querySelectorAll('.approveBtn').forEach((btn) => {
                btn.addEventListener('click', (e) => {
                    const phoneNumber = e.target.getAttribute('data-phone');
                    update(ref(database, 'users/' + phoneNumber), { status: 'approved' })
                        .then(() => alert("User approved"));
                });
            });

            document.querySelectorAll('.rejectBtn').forEach((btn) => {
                btn.addEventListener('click', (e) => {
                    const phoneNumber = e.target.getAttribute('data-phone');
                    update(ref(database, 'users/' + phoneNumber), { status: 'rejected' })
                        .then(() => alert("User rejected"));
                });
            });
        });
    </script>
</body>
</html>
