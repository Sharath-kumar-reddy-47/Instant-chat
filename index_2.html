<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Chat</title>
    <link rel="stylesheet" href="style.css">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
        import { getDatabase, ref, set, onChildAdded, push } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = {
                apiKey: "API_KEY_HERE",
                authDomain: "your-app.firebaseapp.com",
                databaseURL: "https://your-app.firebaseio.com",
                projectId: "your-app-id",
                storageBucket: "your-app.appspot.com",
                messagingSenderId: "messagingSenderId",
                appId: "your-app-id"
            };

            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            const postsRef = ref(database, 'Posts');
            const postsDiv = document.getElementById('posts');
            const newPostInput = document.getElementById('newPost');
            const submitBtn = document.getElementById('submitBtn');

            // Function to auto-detect URLs and make them clickable
            function autoDetectUrls(text) {
                const urlPattern = /(https?:\/\/[^\s]+)/g;
                return text.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
            }

            // Function to detect and style text with double and single quotes
            function styleQuotes(text) {
                const doubleQuotePattern = /"(.*?)"/g;
                const singleQuotePattern = /'(.*?)'/g;
                text = text.replace(doubleQuotePattern, '<b>"$1"</b>');
                text = text.replace(singleQuotePattern, '<span class="light-text">\'$1\'</span>');
                return text;
            }

            // Function to apply both auto URL detection and quote styling
            function processText(text) {
                text = autoDetectUrls(text);
                return styleQuotes(text);
            }

            // Fetch and display posts in real-time
            onChildAdded(postsRef, (snapshot) => {
                const post = snapshot.val();
                const postElement = document.createElement('div');
                
                // Process text for URLs and quotes
                postElement.innerHTML = processText(post.content);
                postsDiv.appendChild(postElement);
            });

            // Submit a new post
            submitBtn.addEventListener('click', () => {
                const postContent = newPostInput.value;
                if (postContent.trim() !== '') {
                    const timestamp = Date.now();

                    // Use push() to create a new post under 'Posts' with a unique key
                    const newPostRef = push(postsRef);
                    set(newPostRef, {
                        content: postContent,
                        timestamp: timestamp
                    }).then(() => {
                        console.log("Post submitted:", postContent);
                    }).catch((error) => {
                        console.error("Error submitting post:", error);
                    });

                    newPostInput.value = ''; // Clear the input after submitting
                } else {
                    console.warn("Input is empty, not submitting.");
                }
            });
        });
    </script>
</head>
<body>
    <div id="posts"></div>
    <input type="text" id="newPost" placeholder="Write something...">
    <button id="submitBtn">Submit</button>
</body>
</html>
